<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Information - Lee & Steven</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="page-container">
        <div class="overlay"></div>
        
        <div class="content-box">
            <h1>Wedding Information</h1>

            <!-- Access Code Form -->
            <div id="code-form-container">
                <p style="text-align: center; color: #666; margin-bottom: 20px;">
                    Please enter the access code to view the wedding details.
                </p>
                <form id="code-form">
                    <label for="accessCode">Access Code:</label>
                    <input type="text" id="accessCode" name="accessCode" required placeholder="Enter code from invitation">
                    <button type="submit">View Details</button>
                </form>
                <div id="code-message"></div>
            </div>

            <!-- Wedding Information (Hidden until code is correct) -->
            <div id="info-content" class="hidden">
                <div class="info-section">
                    <h2>When & Where</h2>
                    <p><strong>Date:</strong> October 4th, 2025</p>
                    <p><strong>Time:</strong> Outdoor ceremony begins at 4:30 PM</p>
                    <p><strong>Reception:</strong> Immediately following ceremony</p>
                    <p><strong>Location:</strong> 1116 Greenspring Valley Rd, Timonium, MD 21093</p>
                </div>

                <div class="info-section">
                    <h2>Accommodations</h2>
                    <p>A block of rooms is reserved for Friday and Saturday under "Gensler" or "Tran-Creque" at:</p>
                    <p><strong>Embassy Suites Baltimore North - Hunt Valley</strong><br>
                    213 International Circle, Hunt Valley, MD<br>
                    <a href="tel:410-584-1400">410-584-1400</a></p>
                </div>

                <div class="info-section">
                    <h2>Dress</h2>
                    <p><strong>Cocktail Attire</strong></p>
                    <p>The ceremony will be held outdoors on the lawn.</p>
                </div>

                <div class="info-section">
                    <h2>Questions?</h2>
                    <p>Please don't hesitate to reach out!</p>
                    <p>Email: <a href="mailto:leegensler@gmail.com">Lee</a> and <a href="mailto:steven.tran.creque@gmail.com">Steven</a> </p>
                </div>

                <div class="nav-link">
                    <a href="/rsvp">RSVP Now</a>
                </div>
            </div>

            <div class="home-link">
                <a href="/">Back to Home</a>
            </div>
        </div>
    </div>
    
    <script>
        // IMPORTANT: Replace this with your actual Worker URL
        const WORKER_URL = 'https://wedding-rsvp-api.cluett26.workers.dev';
        
        const codeForm = document.getElementById('code-form');
        const codeFormContainer = document.getElementById('code-form-container');
        const infoContent = document.getElementById('info-content');
        const codeMessage = document.getElementById('code-message');

        codeForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const code = document.getElementById('accessCode').value;
            const submitButton = codeForm.querySelector('button');
            
            // Show loading state
            submitButton.textContent = 'Checking...';
            submitButton.disabled = true;
            codeMessage.innerHTML = '';

            try {
                const response = await fetch(`${WORKER_URL}/api/check-code`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code }),
                });

                if (response.ok) {
                    // Code is correct - show content
                    codeFormContainer.classList.add('hidden');
                    infoContent.classList.remove('hidden');
                    
                    // Store in session so they don't have to re-enter on this page
                    sessionStorage.setItem('weddingCodeVerified', 'true');
                } else {
                    // Invalid code
                    codeMessage.innerHTML = '<div class="error">Invalid access code. Please try again.</div>';
                    document.getElementById('accessCode').value = '';
                    document.getElementById('accessCode').focus();
                }
            } catch (error) {
                console.error('Error:', error);
                codeMessage.innerHTML = '<div class="error">An error occurred. Please try again.</div>';
            } finally {
                submitButton.textContent = 'View Details';
                submitButton.disabled = false;
            }
        });

        // Check if already verified in this session
        if (sessionStorage.getItem('weddingCodeVerified') === 'true') {
            codeFormContainer.classList.add('hidden');
            infoContent.classList.remove('hidden');
        }
    </script>
</body>
</html>